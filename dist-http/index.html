<!DOCTYPE html>
<html lang="zh-cmn-Hans">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="./dlc.png" />
    <title>DeepLink</title>
    <script type="module" crossorigin src="./assets/index-DfH6EOLw.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-BmCEde1a.css">
  </head>
  <body>
    <script>
      ;(function () {
        function dispatch(jsonLike) {
          var json = typeof jsonLike === 'string' ? jsonLike : JSON.stringify(jsonLike)
          try {
            window.dispatchEvent(new CustomEvent('toH5', { detail: json }))
          } catch (e) {}
        }
        var FLAG = '__wrapped_toH5__'
        function wrap(fn) {
          if (fn && fn[FLAG]) return fn
          function wrapped(arg) {
            dispatch(arg) // 广播事件，给 hooks 收
            if (typeof fn === 'function') {
              try {
                return fn.apply(this, arguments)
              } catch (e) {}
            }
          }
          try {
            Object.defineProperty(wrapped, FLAG, { value: true })
          } catch (e) {}
          return wrapped
        }
        var _toH5 = wrap(window.toH5)
        try {
          Object.defineProperty(window, 'toH5', {
            configurable: true,
            get: function () {
              return _toH5
            },
            set: function (v) {
              _toH5 = wrap(v)
            },
          })
        } catch (e) {
          // 某些环境无法 defineProperty 到 window，则退化为当前时刻包裹
          window.toH5 = _toH5
        }
        if (typeof _toH5 !== 'function') {
          window.toH5 = function (arg) {
            dispatch(arg)
          }
        }
      })()
    </script>

    <script>
      ;(function () {
        var ua = navigator.userAgent

        // iOS (WKWebView)
        if (
          /iPhone|iPad|iPod/i.test(ua) &&
          window.webkit &&
          window.webkit.messageHandlers &&
          window.webkit.messageHandlers.dlc
        ) {
          window.dlc = {
            toNative: function (msg) {
              // iOS 侧常见期望为对象，这里容错：字符串则尝试转对象
              try {
                msg = typeof msg === 'string' ? JSON.parse(msg) : msg
              } catch (e) {}
              window.webkit.messageHandlers.dlc.postMessage(msg)
            },
          }
        }
        // Windows / PC 浏览器（调试环境）
        else if (!window.dlc) {
          window.dlc = {
            toNative: function (msg) {
              // 仅打印，PC 不回放 4001；真机联调时由原生回调 window.toH5
              console.log('dlc.toNative mock (Windows/debug) ->', msg)
            },
          }
        }
      })()
    </script>

    <div id="app"></div>

    <!-- 正常 http/https 走模块化 -->
  </body>
</html>
