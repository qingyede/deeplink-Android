import{r as p,aK as D,au as k}from"./index-D09qPjuF.js";function O(){const o=p(!1),l=p(w());let s=null;function w(){const t=localStorage.getItem("clientID");if(t)return t;const e=`${Math.floor(Math.random()*9+1)}${Array(8).fill(0).map(()=>Math.floor(Math.random()*10)).join("")}`;return localStorage.setItem("clientID",e),e}function b({id:t,password:e}){const a={action:1001,data:{name:t,password:e,clientID:l.value}};console.log(a,"payloadpayloadpayload"),window.dlc.toNative(JSON.stringify(a)),o.value=!0,m()}function h(t){var a,n;const e={action:1001,data:t};if(console.log("[安卓远程连接 Payload]",e),!((a=window.dlc)!=null&&a.toNative)){(n=window.$message)==null||n.warning("未检测到 Native 桥接对象 window.dlc");return}window.dlc.toNative(JSON.stringify(e)),o.value=!0,m()}function g(){var e;const t={action:3004,data:{clientID:l.value,timestamp:Date.now(),type:"heartbeat"}};(e=window.dlc)!=null&&e.toNative?window.dlc.toNative(JSON.stringify(t)):console.warn("❗️ 心跳发送失败，dlc 不存在")}function m(){r(),s=setInterval(()=>{g()},5e3)}function r(){s&&(clearInterval(s),s=null)}return D(window,"toH5",t=>{var e,a,n,v,u,y;try{const c=typeof t=="string"?t:t.detail,i=typeof c=="string"?JSON.parse(c):c,d=typeof(i==null?void 0:i.data)=="string"?JSON.parse(i.data):i;if((d==null?void 0:d.method)==="authAck"){const{version:A,nft_enabled:S,cafe_selfuse:I}=d.data||{};console.log("[远程] 收到 authAck:",d.data),I===!0?(a=(e=window.$message)==null?void 0:e.warning)==null||a.call(e,"当前网吧机器处于“内部自用/禁止自动挖矿”状态，禁止被远程。"):S===!1?(v=(n=window.$message)==null?void 0:n.error)==null||v.call(n,"被控端未启用 NFT，来自 Android 的远程认证不通过。"):(y=(u=window.$message)==null?void 0:u.info)==null||y.call(u,"收到被控端认证回执（authAck），已停止远程。"),o.value=!1,r();return}const{action:N,data:f}=i;switch(console.log(f,"✅原声发给我的数据"),N){case 2001:console.log("[远程] 串流断开"),o.value=!1,r();break;case 2002:console.warn("[远程] 串流失败：",(f==null?void 0:f.message)||f),o.value=!1,r();break;case 2e3:console.log("[远程] 串流成功");break;default:break}}catch(c){console.error("解析 window.toH5 数据失败",c)}}),k(()=>{r()}),{isConnected:o,clientID:l,connectToRemoteDevice:b,connectToAndroidRemoteDevice:h,sendHeartbeat:g,stopHeartbeat:r}}function T(o){const l=JSON.stringify(o),s=new TextEncoder().encode(l);return btoa(String.fromCharCode(...s))}export{T as o,O as u};
