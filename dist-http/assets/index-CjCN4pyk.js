var Se=Object.defineProperty;var ce=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var de=(e,t,n)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,pe=(e,t)=>{for(var n in t||(t={}))ze.call(t,n)&&de(e,n,t[n]);if(ce)for(var n of ce(t))De.call(t,n)&&de(e,n,t[n]);return e};var M=(e,t,n)=>new Promise((o,r)=>{var c=a=>{try{s(n.next(a))}catch(g){r(g)}},d=a=>{try{s(n.throw(a))}catch(g){r(g)}},s=a=>a.done?o(a.value):Promise.resolve(a.value).then(c,d);s((n=n.apply(e,t)).next())});import{H as j,I as f,ab as Te,a9 as V,aa as ue,aE as Re,aF as Pe,d as W,K as he,N as ee,aG as Ie,k as q,af as Z,P as be,ad as Be,l as u,aH as Me,aI as Ne,h as le,u as ae,r as A,n as te,o as T,c as B,e as $,t as b,f as S,b as m,w as y,F as Q,s as F,E as re,B as Y,C as _e,au as xe,_ as ye,X,as as Ee,q as ge,aJ as Le}from"./index-ChhltHVQ.js";import{u as Oe}from"./useAppSocket-D0Jxy0CL.js";import{a as je,u as we,b as Ve,g as Fe}from"./cloud-computers-VA6A9N4V.js";import{u as $e}from"./Popover-Cjx2o8ka.js";import{g as Ae,_ as Ue}from"./Grid-2xvDnFFT.js";import{a as He}from"./Select-BHXx3xnx.js";import{u as Ge,o as ne}from"./objToBase64-PiLJKjIy.js";import{_ as Ke}from"./contracts-C9jLvQn_.js";import{d as Je,b as We}from"./decryptKeystore-vcF9PyHc.js";import{N as ie}from"./GradientText-CLZFWYbX.js";import{u as qe}from"./index-BqyPU7BF.js";import{_ as Xe}from"./Skeleton-dZHpmH9y.js";import{_ as Qe}from"./Empty-D7xXSAQi.js";import"./removeGeForceRTX-DO37ZxPc.js";import"./useGetDlcPrice-Cj32P7WO.js";import"./transferToUsd-CHpIPDKe.js";import"./units-C_OuvvnV.js";import"./maths-Byej6qXm.js";import"./get-HvKeKp0F.js";import"./Follower-C8-nufE8.js";import"./use-locale-Dbc-qWHc.js";import"./Suffix-CiGOD4QE.js";import"./utils-BdpDvbhP.js";import"./create-D3Vn69pI.js";import"./wallet-DM2W-3OY.js";import"./use-houdini-Bm8e05Yt.js";function me(e,t="default",n=[]){const{children:o}=e;if(o!==null&&typeof o=="object"&&!Array.isArray(o)){const r=o[t];if(typeof r=="function")return r()}return n}const ke="DESCRIPTION_ITEM_FLAG";function Ye(e){return typeof e=="object"&&e&&!Array.isArray(e)?e.type&&e.type[ke]:!1}const Ze=j([f("descriptions",{fontSize:"var(--n-font-size)"},[f("descriptions-separator",`
 display: inline-block;
 margin: 0 8px 0 2px;
 `),f("descriptions-table-wrapper",[f("descriptions-table",[f("descriptions-table-row",[f("descriptions-table-header",{padding:"var(--n-th-padding)"}),f("descriptions-table-content",{padding:"var(--n-td-padding)"})])])]),Te("bordered",[f("descriptions-table-wrapper",[f("descriptions-table",[f("descriptions-table-row",[j("&:last-child",[f("descriptions-table-content",{paddingBottom:0})])])])])]),V("left-label-placement",[f("descriptions-table-content",[j("> *",{verticalAlign:"top"})])]),V("left-label-align",[j("th",{textAlign:"left"})]),V("center-label-align",[j("th",{textAlign:"center"})]),V("right-label-align",[j("th",{textAlign:"right"})]),V("bordered",[f("descriptions-table-wrapper",`
 border-radius: var(--n-border-radius);
 overflow: hidden;
 background: var(--n-merged-td-color);
 border: 1px solid var(--n-merged-border-color);
 `,[f("descriptions-table",[f("descriptions-table-row",[j("&:not(:last-child)",[f("descriptions-table-content",{borderBottom:"1px solid var(--n-merged-border-color)"}),f("descriptions-table-header",{borderBottom:"1px solid var(--n-merged-border-color)"})]),f("descriptions-table-header",`
 font-weight: 400;
 background-clip: padding-box;
 background-color: var(--n-merged-th-color);
 `,[j("&:not(:last-child)",{borderRight:"1px solid var(--n-merged-border-color)"})]),f("descriptions-table-content",[j("&:not(:last-child)",{borderRight:"1px solid var(--n-merged-border-color)"})])])])])]),f("descriptions-header",`
 font-weight: var(--n-th-font-weight);
 font-size: 18px;
 transition: color .3s var(--n-bezier);
 line-height: var(--n-line-height);
 margin-bottom: 16px;
 color: var(--n-title-text-color);
 `),f("descriptions-table-wrapper",`
 transition:
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[f("descriptions-table",`
 width: 100%;
 border-collapse: separate;
 border-spacing: 0;
 box-sizing: border-box;
 `,[f("descriptions-table-row",`
 box-sizing: border-box;
 transition: border-color .3s var(--n-bezier);
 `,[f("descriptions-table-header",`
 font-weight: var(--n-th-font-weight);
 line-height: var(--n-line-height);
 display: table-cell;
 box-sizing: border-box;
 color: var(--n-th-text-color);
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `),f("descriptions-table-content",`
 vertical-align: top;
 line-height: var(--n-line-height);
 display: table-cell;
 box-sizing: border-box;
 color: var(--n-td-text-color);
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[ue("content",`
 transition: color .3s var(--n-bezier);
 display: inline-block;
 color: var(--n-td-text-color);
 `)]),ue("label",`
 font-weight: var(--n-th-font-weight);
 transition: color .3s var(--n-bezier);
 display: inline-block;
 margin-right: 14px;
 color: var(--n-th-text-color);
 `)])])])]),f("descriptions-table-wrapper",`
 --n-merged-th-color: var(--n-th-color);
 --n-merged-td-color: var(--n-td-color);
 --n-merged-border-color: var(--n-border-color);
 `),Re(f("descriptions-table-wrapper",`
 --n-merged-th-color: var(--n-th-color-modal);
 --n-merged-td-color: var(--n-td-color-modal);
 --n-merged-border-color: var(--n-border-color-modal);
 `)),Pe(f("descriptions-table-wrapper",`
 --n-merged-th-color: var(--n-th-color-popover);
 --n-merged-td-color: var(--n-td-color-popover);
 --n-merged-border-color: var(--n-border-color-popover);
 `))]),et=Object.assign(Object.assign({},ee.props),{title:String,column:{type:Number,default:3},columns:Number,labelPlacement:{type:String,default:"top"},labelAlign:{type:String,default:"left"},separator:{type:String,default:":"},size:{type:String,default:"medium"},bordered:Boolean,labelClass:String,labelStyle:[Object,String],contentClass:String,contentStyle:[Object,String]}),tt=W({name:"Descriptions",props:et,setup(e){const{mergedClsPrefixRef:t,inlineThemeDisabled:n}=he(e),o=ee("Descriptions","-descriptions",Ze,Ie,e,t),r=q(()=>{const{size:d,bordered:s}=e,{common:{cubicBezierEaseInOut:a},self:{titleTextColor:g,thColor:v,thColorModal:p,thColorPopover:z,thTextColor:x,thFontWeight:h,tdTextColor:I,tdColor:R,tdColorModal:G,tdColorPopover:_,borderColor:L,borderColorModal:K,borderColorPopover:N,borderRadius:E,lineHeight:U,[Z("fontSize",d)]:O,[Z(s?"thPaddingBordered":"thPadding",d)]:H,[Z(s?"tdPaddingBordered":"tdPadding",d)]:l}}=o.value;return{"--n-title-text-color":g,"--n-th-padding":H,"--n-td-padding":l,"--n-font-size":O,"--n-bezier":a,"--n-th-font-weight":h,"--n-line-height":U,"--n-th-text-color":x,"--n-td-text-color":I,"--n-th-color":v,"--n-th-color-modal":p,"--n-th-color-popover":z,"--n-td-color":R,"--n-td-color-modal":G,"--n-td-color-popover":_,"--n-border-radius":E,"--n-border-color":L,"--n-border-color-modal":K,"--n-border-color-popover":N}}),c=n?be("descriptions",q(()=>{let d="";const{size:s,bordered:a}=e;return a&&(d+="a"),d+=s[0],d}),r,e):void 0;return{mergedClsPrefix:t,cssVars:n?void 0:r,themeClass:c==null?void 0:c.themeClass,onRender:c==null?void 0:c.onRender,compitableColumn:$e(e,["columns","column"]),inlineThemeDisabled:n}},render(){const e=this.$slots.default,t=e?Be(e()):[];t.length;const{contentClass:n,labelClass:o,compitableColumn:r,labelPlacement:c,labelAlign:d,size:s,bordered:a,title:g,cssVars:v,mergedClsPrefix:p,separator:z,onRender:x}=this;x==null||x();const h=t.filter(_=>Ye(_)),I={span:0,row:[],secondRow:[],rows:[]},G=h.reduce((_,L,K)=>{const N=L.props||{},E=h.length-1===K,U=["label"in N?N.label:me(L,"label")],O=[me(L)],H=N.span||1,l=_.span;_.span+=H;const C=N.labelStyle||N["label-style"]||this.labelStyle,i=N.contentStyle||N["content-style"]||this.contentStyle;if(c==="left")a?_.row.push(u("th",{class:[`${p}-descriptions-table-header`,o],colspan:1,style:C},U),u("td",{class:[`${p}-descriptions-table-content`,n],colspan:E?(r-l)*2+1:H*2-1,style:i},O)):_.row.push(u("td",{class:`${p}-descriptions-table-content`,colspan:E?(r-l)*2:H*2},u("span",{class:[`${p}-descriptions-table-content__label`,o],style:C},[...U,z&&u("span",{class:`${p}-descriptions-separator`},z)]),u("span",{class:[`${p}-descriptions-table-content__content`,n],style:i},O)));else{const w=E?(r-l)*2:H*2;_.row.push(u("th",{class:[`${p}-descriptions-table-header`,o],colspan:w,style:C},U)),_.secondRow.push(u("td",{class:[`${p}-descriptions-table-content`,n],colspan:w,style:i},O))}return(_.span>=r||E)&&(_.span=0,_.row.length&&(_.rows.push(_.row),_.row=[]),c!=="left"&&_.secondRow.length&&(_.rows.push(_.secondRow),_.secondRow=[])),_},I).rows.map(_=>u("tr",{class:`${p}-descriptions-table-row`},_));return u("div",{style:v,class:[`${p}-descriptions`,this.themeClass,`${p}-descriptions--${c}-label-placement`,`${p}-descriptions--${d}-label-align`,`${p}-descriptions--${s}-size`,a&&`${p}-descriptions--bordered`]},g||this.$slots.header?u("div",{class:`${p}-descriptions-header`},g||Ae(this,"header")):null,u("div",{class:`${p}-descriptions-table-wrapper`},u("table",{class:`${p}-descriptions-table`},u("tbody",null,c==="top"&&u("tr",{class:`${p}-descriptions-table-row`,style:{visibility:"collapse"}},Me(r*2,u("td",null))),G))))}}),ot={label:String,span:{type:Number,default:1},labelClass:String,labelStyle:[Object,String],contentClass:String,contentStyle:[Object,String]},nt=W({name:"DescriptionsItem",[ke]:!0,props:ot,render(){return null}}),st=f("text",`
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
`,[V("strong",`
 font-weight: var(--n-font-weight-strong);
 `),V("italic",{fontStyle:"italic"}),V("underline",{textDecoration:"underline"}),V("code",`
 line-height: 1.4;
 display: inline-block;
 font-family: var(--n-font-famliy-mono);
 transition: 
 color .3s var(--n-bezier),
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 box-sizing: border-box;
 padding: .05em .35em 0 .35em;
 border-radius: var(--n-code-border-radius);
 font-size: .9em;
 color: var(--n-code-text-color);
 background-color: var(--n-code-color);
 border: var(--n-code-border);
 `)]),rt=Object.assign(Object.assign({},ee.props),{code:Boolean,type:{type:String,default:"default"},delete:Boolean,strong:Boolean,italic:Boolean,underline:Boolean,depth:[String,Number],tag:String,as:{type:String,validator:()=>!0,default:void 0}}),it=W({name:"Text",props:rt,setup(e){const{mergedClsPrefixRef:t,inlineThemeDisabled:n}=he(e),o=ee("Typography","-text",st,Ne,e,t),r=q(()=>{const{depth:d,type:s}=e,a=s==="default"?d===void 0?"textColor":`textColor${d}Depth`:Z("textColor",s),{common:{fontWeightStrong:g,fontFamilyMono:v,cubicBezierEaseInOut:p},self:{codeTextColor:z,codeBorderRadius:x,codeColor:h,codeBorder:I,[a]:R}}=o.value;return{"--n-bezier":p,"--n-text-color":R,"--n-font-weight-strong":g,"--n-font-famliy-mono":v,"--n-code-border-radius":x,"--n-code-text-color":z,"--n-code-color":h,"--n-code-border":I}}),c=n?be("text",q(()=>`${e.type[0]}${e.depth||""}`),r,e):void 0;return{mergedClsPrefix:t,compitableTag:$e(e,["as","tag"]),cssVars:n?void 0:r,themeClass:c==null?void 0:c.themeClass,onRender:c==null?void 0:c.onRender}},render(){var e,t,n;const{mergedClsPrefix:o}=this;(e=this.onRender)===null||e===void 0||e.call(this);const r=[`${o}-text`,this.themeClass,{[`${o}-text--code`]:this.code,[`${o}-text--delete`]:this.delete,[`${o}-text--strong`]:this.strong,[`${o}-text--italic`]:this.italic,[`${o}-text--underline`]:this.underline}],c=(n=(t=this.$slots).default)===null||n===void 0?void 0:n.call(t);return this.code?u("code",{class:r,style:this.cssVars},this.delete?u("del",null,c):c):this.delete?u("del",{class:r,style:this.cssVars},c):u(this.compitableTag||"span",{class:r,style:this.cssVars},c)}});function Ce(e){var t;if(console.log(e,"MMMM"),typeof e!="string")return"";try{const n=JSON.parse(e);return n&&typeof n=="object"&&"name"in n?String((t=n.name)!=null?t:""):e}catch(n){return e}}function fe(e){var t;if(typeof e!="string")return"";try{const n=JSON.parse(e);return n&&typeof n=="object"&&"notes"in n?String((t=n.notes)!=null?t:""):""}catch(n){return""}}const lt={class:"dark:text-white text-[17px] font-bold my-4"},at={class:"flex flex-col gap-2"},ct={class:""},dt={class:"text-blue-600 font-mono"},pt={class:""},ut={class:"flex items-center space-x-3"},gt={class:""},mt={class:"break-all flex-1"},ft=W({__name:"deviceInfoDIalog",props:["item","d","fetchDeviceList"],setup(e){const t=le(),{t:n}=ae(),o=e;let r=A("");const c=A(!1),d=A("");function s(){d.value=r.value,c.value=!0}te(()=>{r.value=fe(o.item.device_name)});function a(){return M(this,null,function*(){var p,z,x;console.log(o,"item",fe(o.item.device_name));const{data:v}=yield je({wallet:t.address,device_id:o.item.device_id,name:Ce(o.item.device_name),notes:d.value});v.success&&(r.value=d.value,c.value=!1,(p=window.$message)==null||p.success("添加成功"),(x=(z=o.d).destroy)==null||x.call(z),o.fetchDeviceList())})}function g(){c.value=!1,d.value=""}return(v,p)=>{var I;const z=it,x=Y,h=Ue;return T(),B(Q,null,[$("div",lt,b(`${S(n)("devices.name")}：${(I=o.item)==null?void 0:I.name}`),1),$("div",at,[m(z,{class:"dark:!text-white"},{default:y(()=>{var R;return[$("span",ct,b(v.$t("devices.code"))+"：",1),$("span",dt,b((R=o.item)==null?void 0:R.deviceCode),1)]}),_:1}),m(z,{class:"dark:!text-white"},{default:y(()=>{var R;return[$("span",pt,b(v.$t("devices.os"))+"：",1),$("span",null,b((R=o.item)==null?void 0:R.os),1)]}),_:1}),$("div",ut,[$("span",gt,b(v.$t("devices.remark"))+"：",1),!c.value&&S(r)?(T(),B(Q,{key:0},[$("span",mt,b(S(r)),1),m(x,{size:"tiny",onClick:s},{default:y(()=>[F(b(v.$t("devices.edit")),1)]),_:1})],64)):!c.value&&!S(r)?(T(),re(x,{key:1,size:"tiny",type:"primary",onClick:s},{default:y(()=>[F(b(v.$t("devices.addRemark")),1)]),_:1})):(T(),B(Q,{key:2},[m(h,{value:d.value,"onUpdate:value":p[0]||(p[0]=R=>d.value=R),placeholder:v.$t("devices.inputRemark"),class:"flex-1"},null,8,["value","placeholder"]),m(x,{size:"tiny",type:"primary",onClick:a},{default:y(()=>[F(b(v.$t("devices.save")),1)]),_:1}),m(x,{size:"tiny",onClick:g},{default:y(()=>[F(b(v.$t("devices.cancel")),1)]),_:1})],64))])])],64)}}});function vt(e,t){const n=A(0),o=()=>{const a=Date.now(),v=e+t*1e3-a;n.value=Math.max(0,Math.floor(v/1e3))},r=q(()=>Math.floor(n.value/60)),c=q(()=>n.value%60),{pause:d,resume:s}=_e(o,1e3,{immediate:!0});return te(()=>{s()}),xe(()=>{d()}),{minutes:r,seconds:c,remainingSeconds:n,pause:d,resume:s}}const ht=W({__name:"CountdownTimer",props:{startTime:{},rentSeconds:{}},setup(e){const t=e,{minutes:n,seconds:o}=vt(t.startTime,t.rentSeconds);return(r,c)=>(T(),B("span",null,b(S(n))+" "+b(r.$t("devices.minute"))+" "+b(S(o))+" "+b(r.$t("devices.second")),1))}}),bt={class:"flex flex-col gap-5"},_t={class:"font-mono break-all text-xs text-gray-500 dark:text-gray-300"},xt=W({__name:"myDeviceInfo",props:["info","d"],setup(e){const t=we(),{t:n}=ae(),o=e;function r(s){console.log(s,"secondssecondssecondssecondssecondsseconds");const a=Math.floor(s/3600),g=Math.floor(s%3600/60),v=s%60;let p=[];return a>0&&p.push(`${a}${n("devices.hour")}`),g>0&&p.push(`${g}${n("devices.minute")}`),(v>0||s===0)&&p.push(`${v}${n("devices.second")}`),p.join("")||"0秒"}te(()=>{console.log(o,"propspropsprops")});const c=s=>M(this,null,function*(){var a,g;console.log(s,">>>>>>>>>>>>",o.d),t.rentMachineDialogBeforeForm.rentinfo=s,yield t.renewRentFlow(s),(g=(a=o.d)==null?void 0:a.destroy)==null||g.call(a)}),d=s=>M(this,null,function*(){var a,g;console.log(s),t.rentMachineDialogBeforeForm.rentinfo=s,yield t.endRentFlow(s==null?void 0:s.machine_id),(g=(a=o.d)==null?void 0:a.destroy)==null||g.call(a)});return(s,a)=>{const g=nt,v=He,p=ht,z=Y,x=tt;return T(),B("div",bt,[m(x,{bordered:"",size:"medium",column:1,"label-placement":"left",class:"text-sm","label-class":"text-xs md:text-sm dark:!bg-[#1a1a1a] dark:!text-white","content-class":"dark:bg-[#1a1a1a] text-gray-500 dark:!text-white"},{default:y(()=>[m(g,{label:s.$t("devices.deviceId"),span:2},{default:y(()=>{var h;return[F(b((h=o.info)==null?void 0:h.device_id),1)]}),_:1},8,["label"]),m(g,{label:s.$t("devices.gpuType")},{default:y(()=>[m(v,{type:"success",size:"small",round:""},{default:y(()=>{var h,I;return[F(b(((h=o.info)==null?void 0:h.machine_info.gpuType)||((I=o.info)==null?void 0:I.machine_info.gpu_type)),1)]}),_:1})]),_:1},8,["label"]),m(g,{label:s.$t("devices.systemType")},{default:y(()=>[m(v,{type:"info",size:"small",round:""},{default:y(()=>{var h;return[F(b((h=o.info)==null?void 0:h.os_release),1)]}),_:1})]),_:1},8,["label"]),m(g,{label:s.$t("devices.identityCode")},{default:y(()=>{var h;return[$("span",_t,b((h=o.info)==null?void 0:h.device_id),1)]}),_:1},8,["label"]),m(g,{label:s.$t("devices.remainingTime")},{default:y(()=>[m(p,{"start-time":o.info.rent_satrtime,"rent-seconds":o.info.rent_time},null,8,["start-time","rent-seconds"])]),_:1},8,["label"]),m(g,{label:s.$t("devices.totalDuration")},{default:y(()=>[$("span",null,b(r(o.info.rent_time)),1)]),_:1},8,["label"]),m(g,{label:s.$t("devices.rent_end")},{default:y(()=>[m(z,{onClick:a[0]||(a[0]=h=>d(o.info)),class:"w-full rounded-lg",secondary:"",type:"primary"},{default:y(()=>[F(b(s.$t("devices.rent_end")),1)]),_:1})]),_:1},8,["label"]),m(g,{label:s.$t("devices.rent_renew")},{default:y(()=>[m(z,{loading:S(t).renewRentLoading,class:"w-full rounded-lg",secondary:"",type:"primary",onClick:a[1]||(a[1]=h=>c(o.info))},{default:y(()=>[F(b(s.$t("devices.rent_renew")),1)]),_:1},8,["loading"])]),_:1},8,["label"])]),_:1})])}}}),yt=ye(xt,[["__scopeId","data-v-c150313d"]]),D=[];for(let e=0;e<256;++e)D.push((e+256).toString(16).slice(1));function wt(e,t=0){return(D[e[t+0]]+D[e[t+1]]+D[e[t+2]]+D[e[t+3]]+"-"+D[e[t+4]]+D[e[t+5]]+"-"+D[e[t+6]]+D[e[t+7]]+"-"+D[e[t+8]]+D[e[t+9]]+"-"+D[e[t+10]]+D[e[t+11]]+D[e[t+12]]+D[e[t+13]]+D[e[t+14]]+D[e[t+15]]).toLowerCase()}let se;const $t=new Uint8Array(16);function kt(){if(!se){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");se=crypto.getRandomValues.bind(crypto)}return se($t)}const Ct=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ve={randomUUID:Ct};function St(e,t,n){var r,c,d;if(ve.randomUUID&&!t&&!e)return ve.randomUUID();e=e||{};const o=(d=(c=e.random)!=null?c:(r=e.rng)==null?void 0:r.call(e))!=null?d:kt();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,wt(o)}function zt(e){return St().replace(/-/g,"").slice(0,e)}function Dt(e){return{getEvmSignature:()=>M(this,null,function*(){const n=A(null);return new Promise(o=>{var c;const r=(c=window.$dialog)==null?void 0:c.warning({title:()=>u(ie,{size:24,type:"success",class:"font-bold"},{default:()=>e("app.walletUnlock")}),content:()=>u(Ke,{ref:n}),positiveText:e("app.confirm"),negativeText:e("app.cancel"),class:"rounded-2xl dark:bg-[#1a1a1a] dark:text-white",negativeButtonProps:{color:"#3CD8A6",size:"medium"},positiveButtonProps:{color:"#03C188",size:"medium"},onPositiveClick:()=>M(this,null,function*(){var d;r.loading=!0,r.positiveText=e("app.processing");try{const s=n.value,a=s==null?void 0:s.formRef,g=s==null?void 0:s.model;if(!a||!g){r.loading=!1,r.positiveText=e("app.confirm"),o(null);return}if(!(yield new Promise(R=>{a.validate(G=>R(!G))}))){(d=window.$message)==null||d.error(e("app.passwordError")),r.loading=!1,r.positiveText=e("app.confirm"),o(!1);return}const{privateKey:p,address:z}=yield Je(le().keystore,g.password,e),x=zt(8),{nonce:h,signature:I}=yield We(x,p);o({nonce:h,signature:I})}catch(s){r.loading=!1,r.positiveText=e("app.confirm"),o(!1)}}),onNegativeClick:()=>o(null)})})})}}const Tt={class:"px-[16px]"},Rt={class:"text-lg w-full"},Pt={key:0,class:"flex flex-col gap-2"},It={key:1,class:"flex flex-col gap-2"},Bt={class:"flex flex-nowrap justify-between w-full gap-8"},Mt={class:"flex items-center gap-2 flex-1 justify-center flex-wrap"},Nt={class:"rounded-lg bg-white dark:bg-[#444] w-8 h-8 p-1"},Et={class:"text-sm text-left md:text-base font-bold text-black dark:text-white text-wrap flex-1"},Lt={class:"flex items-center gap-1 max-w-[120px] justify-center"},Ot={class:"text-base text-[#615F63] dark:text-white/70 text-wrap"},jt={key:2,class:"my-6"},Vt={key:0,class:"flex flex-col gap-3"},Ft={key:1,class:"flex flex-col gap-2"},At={class:"flex justify-between w-full gap-8"},Ut={class:"flex items-center gap-6 flex-1 justify-start"},Ht={class:"rounded-lg bg-white dark:bg-[#444] w-8 h-8 p-1"},Gt={class:"flex flex-col gap-1 justify-start items-start"},Kt={class:"text-sm text-left md:text-base font-bold text-black dark:text-white text-wrap"},Jt={key:2,class:"my-6"},Wt=W({__name:"index",setup(e){const{t}=ae();we();const{getEvmSignature:n}=Dt(t),o=qe(),{connectToRemoteDevice:r,connectToAndroidRemoteDevice:c}=Ge(),d=le(),{connect:s,send:a,onMessage:g,waitForReady:v,onOpen:p,offMessage:z}=Oe(),x=Ve();function h(l,C,i=250){let w=0,P=null;return(...k)=>{const J=Date.now(),oe=J-w;w=J,P&&(clearTimeout(P),P=null),oe<i?C(...k):P=setTimeout(()=>{l(...k),P=null},i)}}const I=h((l,C)=>N(l,C),(l,C)=>E(l,C)),R=h(l=>H(l),l=>E(l,1)),G=()=>u("div",{class:"flex items-center gap-3"},[u(X,{icon:"mdi:devices",class:"!text-[24px] min-w-[30px] min-h-[30px] text-[#000] dark:text-white"}),u("div",{class:"flex flex-wrap"},[u("div",{class:"flex items-center flex-wrap"},[u("div",{class:"text-[#000] dark:text-white text-[14px] font-bold"},t("devices.deviceList")),u("div",{class:"text-[#737373] dark:text-white/60 text-[10px]  ml-1"},t("devices.deviceStartTip"))])])]),_=()=>u("div",{class:"flex items-center gap-3"},[u(X,{icon:"mdi:devices",class:"!text-[24px] min-w-[30px] min-h-[30px] text-[#000] dark:text-white"}),u("div",{class:"flex flex-wrap"},[u("div",{class:"flex items-center flex-wrap"},[u("div",{class:"text-[#000] dark:text-white text-[14px] font-bold"},t("devices.myRentalList")),u("div",{class:"text-[#737373] dark:text-white/60 text-[10px]  ml-1"},t("devices.deviceStartTip"))])])]),L=A([]);let K=A(!0);_e(()=>M(this,null,function*(){x.getUserDeviceListH()}),6e5,{immediateCallback:!0});const N=(l,C)=>{var i;if(C===0){console.log(l);let w=A(!1);const P=(i=window.$dialog)==null?void 0:i.info({title:()=>u(ie,{size:24,type:"success",class:"font-bold"},{default:()=>t("devices.info")}),content:()=>u(ft,{item:l,d:P,fetchDeviceList:O}),class:"rounded-2xl dark:bg-[#1a1a1a] dark:text-white",positiveText:"立即连接",negativeText:t("devices.unbind"),positiveButtonProps:{color:"#03C188",size:"medium"},negativeButtonProps:{color:"#EF4444",loading:w.value,size:"medium"},onPositiveClick:()=>M(this,null,function*(){if(P)try{P.loading=!0,yield E(l,0)}catch(k){}finally{P.loading=!1}}),onNegativeClick:()=>M(this,null,function*(){return console.log(l,"8888888888"),yield a({id:1,method:"unbindDevice",token:d.token,params:{device_id:l.deviceCode}}),!1}),showIcon:!1})}else console.log(l)},E=(l,C)=>M(this,null,function*(){if(C===0){console.log(l,"PPPPPPP"),yield o.getMyNftListH(),console.log(o.hasNft,"buyNft.hasNftbuyNft.hasNftbuyNft.hasNftbuyNft.hasNftbuyNft.hasNft");const i=yield n();if(console.log(i,"签名签名签名签名"),i){console.log({id:l.device_id,password:`evm.renter.${d.address}.${i.nonce}.${i.signature}`},"关键信息");try{r({id:l.device_id,password:ne({wallet:d.address,nonce:i.nonce,signature:i.signature,wallet_type:"evm",wallet_role:1,nft_enabled:o.hasNft,display:{width:1920,height:1080,fps:60}})})}catch(w){return!1}}else return!1}else{l.status==="Online"?l.status="Offline":l.status="Online";const i=yield n();if(console.log(i,"签名签名签名签名"),i){console.log({id:l.device_id,password:`evm.renter.${d.address}.${i.nonce}.${i.signature}`},"关键信息");try{r({id:l.device_id,password:ne({rent_start_time:Math.floor(Date.now()/1e3),rent_time:l.rent_time*60,wallet:d.address,nonce:i.nonce,signature:i.signature,wallet_type:"evm",wallet_role:2,display:{width:1920,height:1080,fps:60}})})}catch(w){return!1}}else return!1}});te(()=>M(this,null,function*(){s(),g(U);try{yield v()}catch(l){console.warn("[WS] ❌ 连接失败:",l);return}p(()=>{console.log("[onOpen] 触发 fetchDeviceList"),setTimeout(()=>{O()},0)}),setTimeout(()=>{O()},0)}));const U=l=>{var C;try{const i=JSON.parse(l.data);console.log(i.method,"message.method"),i.method==="getDeviceList"&&i.result.device_list?(console.log("✅ 具名函数：处理设备列表消息"),L.value=i.result.device_list.map(w=>pe({name:Ce(w.device_name),icon:Fe(w.os_release),status:w.online?t("devices.Online"):t("devices.Offline"),loading:!1,statusValue:w.online?"Online":"Offline",deviceCode:w.device_id,os:w.os_release},w))):i.method==="unbindDevice"&&(console.log(i,"FFF"),window.location.reload(),(C=window.$message)==null||C.success(t("app.unbindSuccess")))}catch(i){console.error("[WS] ❌ 消息解析失败:",i)}finally{K.value=!1}};xe(()=>{z(U)});const O=()=>M(this,null,function*(){K.value=!0,console.log("重新请求"),a({method:"getDeviceList",id:1,token:d.token,params:{}})}),H=l=>{var w;console.log(l,"item");const C=A(),i=(w=window.$dialog)==null?void 0:w.info({title:()=>u(ie,{size:24,type:"success",class:"font-bold"},{default:()=>t("devices.deviceDetails")}),content:()=>u(yt,{ref:C,info:l,d:i}),class:"rounded-2xl dark:bg-[#1a1a1a] dark:text-white",showIcon:!1,negativeButtonProps:{color:"#3CD8A6",size:"medium"},positiveButtonProps:{color:"#03C188",size:"medium"},positiveText:t("devices.connectDevice"),negativeText:t("app.cancel"),onPositiveClick:()=>M(this,null,function*(){var P;if(i){i.loading=!0,i.positiveText="loading...";const k=yield n();if(console.log(k,"签名签名签名签名"),i.loading=!1,i.positiveText=t("devices.connectDevice"),k){console.log({id:l.device_id,password:`evm.renter.${d.address}.${k.nonce}.${k.signature}`},"关键信息");try{r({id:l.device_id,password:ne({rent_start_time:Math.floor(Date.now()/1e3),rent_time:l.rent_time*60,wallet:d.address,nonce:k.nonce,signature:k.signature,wallet_type:"evm",wallet_role:2,display:{width:1920,height:1080,fps:60}})}),(P=i.destroy)==null||P.call(i)}catch(J){return!1}}else return!1}})})};return(l,C)=>{const i=Xe,w=Qe,P=Ee;return T(),B("div",Tt,[m(S(Y),{class:"w-full rounded-lg min-h-[48px] mb-[50px]",type:"primary",round:""},{default:y(()=>[$("span",Rt,b(l.$t("devices.devices")),1)]),_:1}),m(P,{title:G,class:"rounded-lg mb-8 dark:bg-[#1e1e1e] transition-colors duration-300","content-class":"!px-4"},{default:y(()=>[S(K)?(T(),B("div",Pt,[m(i,{class:"rounded-lg",size:"large"}),m(i,{class:"rounded-lg",size:"large"}),m(i,{class:"rounded-lg",size:"large"}),m(i,{class:"rounded-lg",size:"large"})])):L.value.length>0?(T(),B("div",It,[(T(!0),B(Q,null,ge(L.value,(k,J)=>(T(),re(S(Y),{key:J,loading:k.loading,color:"#E1EBE7",class:"rounded-lg py-2 h-full w-full dark:bg-[#2c2c2c] transition-colors duration-300",onClick:oe=>S(I)(k,0)},{default:y(()=>[$("div",Bt,[$("div",Mt,[$("div",Nt,[m(S(X),{icon:k.icon,class:"text-[22px]"},null,8,["icon"])]),$("span",Et,b(k.name),1)]),$("div",Lt,[m(S(X),{icon:"mdi:circle-slice-8",class:"text-[28px] mr-1 animate-pulse",style:Le({color:k.statusValue==="Online"?"green":"red"})},null,8,["style"]),$("span",Ot,b(k.status),1)])])]),_:2},1032,["loading","onClick"]))),128))])):(T(),B("div",jt,[m(w,{description:l.$t("app.noData")},null,8,["description"])]))]),_:1}),m(P,{title:_,class:"rounded-lg dark:bg-[#1e1e1e] transition-colors duration-300","content-class":"!px-4"},{default:y(()=>[S(x).loading?(T(),B("div",Vt,[m(i,{class:"rounded-lg",size:"large"}),m(i,{class:"rounded-lg",size:"large"}),m(i,{class:"rounded-lg",size:"large"}),m(i,{class:"rounded-lg",size:"large"})])):S(x).deviceList.length>0?(T(),B("div",Ft,[(T(!0),B(Q,null,ge(S(x).deviceList,(k,J)=>(T(),re(S(Y),{key:J,loading:k.loading,color:"#E1EBE7",class:"rounded-lg py-2 h-full w-full dark:bg-[#2c2c2c] transition-colors duration-300",onClick:oe=>S(R)(k)},{default:y(()=>[$("div",At,[$("div",Ut,[$("div",Ht,[m(S(X),{icon:k.icon,class:"text-[22px]"},null,8,["icon"])]),$("div",Gt,[$("span",Kt,b(k.name),1)])])])]),_:2},1032,["loading","onClick"]))),128))])):(T(),B("div",Jt,[m(w,{description:l.$t("app.noData")},null,8,["description"])]))]),_:1})])}}}),$o=ye(Wt,[["__scopeId","data-v-a37da1bf"]]);export{$o as default};
