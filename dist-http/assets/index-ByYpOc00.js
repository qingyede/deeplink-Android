var m=($,h,d)=>new Promise((a,f)=>{var w=e=>{try{s(d.next(e))}catch(u){f(u)}},i=e=>{try{s(d.throw(e))}catch(u){f(u)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(w,i);s((d=d.apply($,h)).next())});import{d as S,h as I,i as V,r as R,u as D,a as N,k as x,c as j,e as _,t as W,b as l,w as c,o as q,f as z,B as U,_ as A}from"./index-ChhltHVQ.js";import{u as J}from"./useWallet-DmuDN1W6.js";import{u as L,a as M,C as O,b as T}from"./useDeviceId--RMQ-b2W.js";import{c as G,_ as H,a as Q,b as X}from"./Grid-2xvDnFFT.js";import"./wallet-DM2W-3OY.js";import"./maths-Byej6qXm.js";import"./useAppSocket-D0Jxy0CL.js";import"./use-locale-Dbc-qWHc.js";import"./get-HvKeKp0F.js";import"./Suffix-CiGOD4QE.js";const Y={class:"px-[16px]"},Z={class:"text-black text-[24px] font-bold mb-2"},ee={class:"flex flex-col flex-wrap gap-3"},te={class:"text-[14px] text-[#000]/60 leading-[22px]"},oe={class:"mt-[36px] w-full"},se={class:"text-lg"},ae=S({__name:"index",setup($){const{importFromPrivateKey:h}=J(),{registerDevice:d}=L(),a=I(),f=V(),w=R(null),i=R(!1),{t:s}=D(),e=N({privateKey:"",password:""});x(()=>{if(e.privateKey)return/^0x[0-9a-fA-F]{64}$/.test(e.privateKey)?"success":"error"}),x(()=>e.password?"success":"error");const u=x(()=>e.privateKey.length>0&&e.password.length>0),E={privateKey:[{validator(o,t){return m(this,null,function*(){return(t==null?void 0:t.trim())?Promise.resolve():Promise.reject(new Error(s("openWallet.privateKeyRequired")))})},trigger:["blur","input"]}],password:[{validator(o,t){return m(this,null,function*(){return t?Promise.resolve():Promise.reject(new Error(s("openWallet.passwordRequired")))})},trigger:["blur","input"]}]},P=()=>m(this,null,function*(){var t,r,p,g,v;const o=yield h(e.privateKey,e.password);if(!o){(t=window.$message)==null||t.error(s("app.importFailed")),i.value=!1;return}a.isWalletRegistered=!0,a.address=o.address.toLowerCase(),a.keystore=o.keystore;try{const{data:n}=yield M(a.address),k=n.result?n.result.nonce+1:0;console.log(k,"noncenoncenonce");const{nonce:C,signature:K}=yield O(k,a.keystore,e.password,"json","EVM");console.log("签名结果:",C,K);const b=yield d();if(console.log(b,"device_iddevice_id"),b){const{data:y}=yield T({device_id:b,user_id:a.address,nonce:k,signature:K});if(y.result){a.token=y.result.token;const F=JSON.parse(atob(y.result.token.split(".")[1]));console.log(F,"解密"),console.log(y,"tokentokenRestokenRestokenResRes"),(r=window.$message)==null||r.success(s("openWallet.walletImportSuccess")),f.push({name:"home"})}else(p=window.$message)==null||p.error(s("app.importFailed"))}else(g=window.$message)==null||g.error(s("app.importFailed"));i.value=!1}catch(n){console.error("导入流程失败:",n),(v=window.$message)==null||v.error(s("app.importFailed")),a.$reset()}finally{i.value=!1}}),B=o=>m(this,null,function*(){var t,r;o.preventDefault(),i.value=!0;try{yield(t=w.value)==null?void 0:t.validate(),P()}catch(p){(r=window.$message)==null||r.error(s("openWallet.formInvalid"))}});return(o,t)=>{const r=H,p=Q,g=X,v=G;return q(),j("div",Y,[_("h1",Z,W(o.$t("openWallet.importWallet")),1),_("div",ee,[_("span",te,W(o.$t("openWallet.walletPasswordReminder")),1)]),_("div",oe,[l(v,{ref_key:"formRef",ref:w,model:e,rules:E,"label-placement":"top"},{default:c(()=>[l(g,{cols:24},{default:c(()=>[l(p,{span:24,label:o.$t("openWallet.privateKey"),path:"privateKey"},{default:c(()=>[l(r,{type:"password","show-password-on":"click",class:"min-h-[44px] rounded-lg bg-[#E1EBE7] text-[#737373]",value:e.privateKey,"onUpdate:value":t[0]||(t[0]=n=>e.privateKey=n),placeholder:o.$t("openWallet.enterPrivateKey")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(p,{span:24,label:o.$t("openWallet.password"),path:"password"},{default:c(()=>[l(r,{type:"password","show-password-on":"click",class:"min-h-[44px] rounded-lg bg-[#E1EBE7] text-[#737373]",value:e.password,"onUpdate:value":t[1]||(t[1]=n=>e.password=n),placeholder:o.$t("openWallet.enterWalletPassword")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(p,{span:24},{default:c(()=>[l(z(U),{class:"w-full rounded-lg min-h-[48px]",type:"primary",round:"",onClick:B,disabled:!u.value,loading:i.value},{default:c(()=>[_("span",se,W(o.$t("openWallet.complete")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["model"])])])}}}),we=A(ae,[["__scopeId","data-v-96df0461"]]);export{we as default};
