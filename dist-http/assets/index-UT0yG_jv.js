var C=(b,r,n)=>new Promise((v,u)=>{var _=t=>{try{e(n.next(t))}catch(p){u(p)}},c=t=>{try{e(n.throw(t))}catch(p){u(p)}},e=t=>t.done?v(t.value):Promise.resolve(t.value).then(_,c);e((n=n.apply(b,r)).next())});import{d as T,u as j,h as A,i as K,j as M,r as D,a as O,n as F,c as G,e as g,t as h,b as l,w as i,o as J,f as L,s as U,B as Y,_ as q}from"./index-D09qPjuF.js";import{u as $}from"./useWallet--qQzRsGl.js";import{g as z,a as H,C as Q,u as X,b as Z}from"./useDeviceId-BfKswrSm.js";import{u as ee}from"./useWalletTransfer-C_Mfpmd3.js";import{c as te,_ as oe,a as se,b as ae}from"./Grid-D8jJ9AZ-.js";import"./wallet-DM2W-3OY.js";import"./maths-Byej6qXm.js";import"./useAppSocket-CcqN1Q9Z.js";import"./use-locale-Clgi8CGA.js";import"./get-D38_uRRN.js";import"./Suffix-CD_PMG80.js";const ne={class:"px-[16px]"},le={class:"text-black text-[24px] font-bold mb-2"},re={class:"flex flex-col flex-wrap gap-3"},ce={class:"text-[14px] text-[#000]/60 leading-[22px]"},pe={class:"mt-[50px] w-full"},de=T({__name:"index",setup(b){$();const{t:r}=j(),n=A(),{setWalletData:v}=ee(),u=K();M();const _=D(null);let c=D(!1);const e=O({password:""}),t={password:[{validator:(o,s)=>s?!0:new Error("密码是必须的"),trigger:["blur","input"]}]};F(()=>{z()});const p=o=>{var s;o.preventDefault(),(s=_.value)==null||s.validate(B=>C(this,null,function*(){var d,m,w;if(B)(w=window.$message)==null||w.error(r("app.checkYourPassword"));else{c.value=!0;try{const{address:a,privateKey:k,mnemonic:S,keystore:y,createAndEncryptWallet:N}=$();yield N(e.password),console.log("BBBBBBBBBBBBBBB");const{data:E}=yield H(a.value),x=E.result?E.result.nonce+1:0;console.log(x,"noncenoncenonce");const{nonce:P,signature:R}=yield Q(x,y.value,e.password,"json","EVM");console.log("签名结果:",P,R);const{registerDevice:V}=X(),W=yield V();if(W){const{data:f}=yield Z({device_id:W,user_id:a.value,nonce:x,signature:R});if(f.result){n.token=f.result.token;const I=JSON.parse(atob(f.result.token.split(".")[1]));console.log(I,"解密"),console.log(f,"tokentokenRestokenRestokenResRes"),v({address:a.value,privateKey:k.value,mnemonic:S.value,keystore:y.value,pwd:e.password}),u.push({name:"walletSuccess"}),(d=window.$message)==null||d.success(r("app.walletCreateSuccess"))}}else throw new Error("设备注册失败")}catch(a){console.log(a,"创建钱包失败"),(m=window.$message)==null||m.error(r("app.walletCreateFailed"))}c.value=!1}}))};return(o,s)=>{const B=oe,d=se,m=Y,w=ae,a=te;return J(),G("div",ne,[g("h1",le,h(o.$t("createWallet.newWallet")),1),g("div",re,[g("span",ce,h(o.$t("createWallet.walletPasswordReminder")),1)]),g("div",pe,[l(a,{ref_key:"formRef",ref:_,model:e,rules:t,"label-placement":"top"},{default:i(()=>[l(w,{cols:24},{default:i(()=>[l(d,{span:24,label:o.$t("createWallet.walletPasswordLabel"),path:"password"},{default:i(()=>[l(B,{type:"password","show-password-on":"click",class:"min-h-[44px] rounded-lg bg-[#E1EBE7] text-[#737373]",value:e.password,"onUpdate:value":s[0]||(s[0]=k=>e.password=k),placeholder:o.$t("createWallet.walletPasswordRule")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(d,{span:24},{default:i(()=>[l(m,{class:"w-full rounded-lg min-h-[48px] text-lg",color:e.password?"#03C188":"#D7EDEB",round:"",loading:L(c),onClick:p,disabled:!e.password},{default:i(()=>[U(h(o.$t("createWallet.Create")),1)]),_:1},8,["color","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model"])])])}}}),be=q(de,[["__scopeId","data-v-20474155"]]);export{be as default};
